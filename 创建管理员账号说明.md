# 创建超级管理员账号说明

## 管理员账号信息
- **用户名**: leilei
- **密码**: 123456
- **邮箱**: leilei@admin.com（系统自动转换）
- **角色**: super_admin

## 创建方法

### 方法1：通过应用注册（最简单，推荐）✅

1. 打开应用注册页面
2. 填写信息：
   - **用户名**: `leilei`
   - **邮箱**: `leilei@admin.com` 或直接输入 `leilei`（系统会自动转换为 leilei@admin.com）
   - **密码**: `123456`
3. 点击注册
4. 系统会自动识别并设置为 `super_admin` 角色
5. 如果启用了邮件确认，请查收邮件并点击确认链接

### 方法2：通过Supabase Dashboard手动创建

#### 步骤1：执行数据库迁移
在Supabase Dashboard的SQL编辑器中执行：
```sql
-- 添加role字段
ALTER TABLE user_profiles 
ADD COLUMN IF NOT EXISTS role VARCHAR(20) DEFAULT 'user' CHECK (role IN ('user', 'admin', 'super_admin'));

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_user_profiles_role ON user_profiles(role);
```

#### 步骤2：创建用户
1. 进入 **Supabase Dashboard** -> **Authentication** -> **Users**
2. 点击 **"Add user"** 按钮
3. 填写信息：
   - **Email**: `leilei@admin.com`
   - **Password**: `123456`
   - **Auto Confirm User**: 根据需求勾选（开发环境建议勾选，生产环境建议不勾选）
4. 点击 **"Create user"**
5. 复制创建的用户ID

#### 步骤3：设置管理员角色
在SQL编辑器中执行以下SQL（将 `<USER_ID>` 替换为步骤2中复制的用户ID）：

```sql
INSERT INTO user_profiles (id, username, role, level, experience_points, streak_days, total_words_learned)
VALUES (
  '<USER_ID>',  -- 替换为实际用户ID
  'leilei',
  'super_admin',
  999,
  999999,
  999,
  999999
)
ON CONFLICT (id) DO UPDATE 
SET 
  role = 'super_admin',
  username = 'leilei',
  level = 999,
  experience_points = 999999,
  streak_days = 999,
  total_words_learned = 999999;
```

### 方法3：使用开发工具函数（仅开发环境）

在浏览器控制台中执行：
```javascript
// 导入工具函数
import('./utils/createAdmin').then(m => m.createAdminUser())
```

或者直接调用：
```javascript
// 如果已经暴露到window对象
createAdminUser()
```

## 登录方式

### 方式1：使用用户名登录（推荐）
- 在登录页面的"邮箱或用户名"输入框输入：`leilei`
- 密码：`123456`
- 系统会自动将 `leilei` 转换为 `leilei@admin.com` 进行登录

### 方式2：使用邮箱登录
- 在登录页面的"邮箱或用户名"输入框输入：`leilei@admin.com`
- 密码：`123456`

## 管理员权限

超级管理员（super_admin）拥有以下特性：
- 等级：999
- 经验值：999999
- 连续学习天数：999
- 已学单词数：999999
- 可以访问所有功能（未来可以扩展管理员专用功能）

## 验证管理员账号

登录后，可以在浏览器控制台执行以下代码检查管理员状态：

```javascript
import { supabase } from './lib/supabase'

const { data: { user } } = await supabase.auth.getUser()
const { data: profile } = await supabase
  .from('user_profiles')
  .select('*')
  .eq('id', user.id)
  .single()

console.log('用户角色:', profile?.role)
console.log('是否超级管理员:', profile?.role === 'super_admin')
```

## 注意事项

1. **安全性**：生产环境中，建议：
   - 修改默认密码
   - 使用强密码
   - 启用双因素认证（如果Supabase支持）
   - 限制管理员账号的IP访问

2. **邮件确认**：如果Supabase启用了邮件确认功能，需要：
   - 检查邮箱（包括垃圾邮件文件夹）
   - 点击确认链接激活账户

3. **数据库迁移**：如果数据库还没有 `role` 字段，需要先执行迁移SQL（见方法2的步骤1）

## 故障排除

### 问题1：登录时提示"邮箱或密码错误"
- 检查邮箱是否正确（应该是 `leilei@admin.com`）
- 检查密码是否正确（应该是 `123456`）
- 如果使用用户名 `leilei` 登录，确保系统已正确转换

### 问题2：登录后没有管理员权限
- 检查 `user_profiles` 表中的 `role` 字段是否为 `super_admin`
- 执行以下SQL检查：
```sql
SELECT id, username, role FROM user_profiles WHERE username = 'leilei';
```

### 问题3：注册时提示"用户已存在"
- 说明该邮箱已经被注册
- 可以直接使用该账号登录
- 如果需要设置为管理员，执行方法2的步骤3

## 相关文件

- 数据库迁移脚本：`supabase/migrations/add_admin_role.sql`
- 创建工具函数：`english-learning-app/src/utils/createAdmin.ts`
- 管理员Hook：`english-learning-app/src/hooks/useAdmin.ts`
- 认证组件：`english-learning-app/src/components/Auth.tsx`


